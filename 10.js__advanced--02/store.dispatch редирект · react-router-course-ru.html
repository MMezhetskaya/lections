<!DOCTYPE html>
<!-- saved from url=(0089)https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        
        <title>store.dispatch редирект · react-router-course-ru</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Max P">
        
        
    
    <link rel="stylesheet" href="./store.dispatch редирект · react-router-course-ru_files/style.css">

    
            
                
                <link rel="stylesheet" href="./store.dispatch редирект · react-router-course-ru_files/prism.css">
                
            
                
                <link rel="stylesheet" href="./store.dispatch редирект · react-router-course-ru_files/plugin.css">
                
            
                
                <link rel="stylesheet" href="./store.dispatch редирект · react-router-course-ru_files/search.css">
                
            
                
                <link rel="stylesheet" href="./store.dispatch редирект · react-router-course-ru_files/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/gitbook/images/favicon.ico" type="image/x-icon">

    
    
    
    
    
    

    <link rel="prev" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podklyuchaem_redux.html"><link rel="next" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/zakritii_komponent.html"></head>
    <body style="" cz-shortcut-listen="true">
        
<div class="book without-animation with-summary font-size-2 font-family-1">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Введите условия поиска">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.gitbook.com/book/maxfarseer/react-router-course-ru" target="_blank" class="custom-link">react-router-course-ru</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/">
            
                    
                    Вступление
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="podgotovka.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podgotovka.html">
            
                    
                    Подготовка
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="nastraivaem_dev-okruzhenie.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/nastraivaem_dev-okruzhenie.html">
            
                    
                    Настраиваем dev-окружение
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="sozdaem_primitivnii_router.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/sozdaem_primitivnii_router.html">
            
                    
                    Создаем примитивный роутер
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="podklyuchaem_react-router.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podklyuchaem_react-router.html">
            
                    
                    Подключаем react-router
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="browserhistory_vs_hashhistory.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/browserhistory_vs_hashhistory.html">
            
                    
                    BrowserHistory vs HashHistory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="dopisivaem_routi.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/dopisivaem_routi.html">
            
                    
                    Дописываем роуты
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="aktivnaya_ssilka.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/aktivnaya_ssilka.html">
            
                    
                    Активная ссылка
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="ssilka_na_glavnuyu.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/ssilka_na_glavnuyu.html">
            
                    
                    Ссылка на главную
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="indexredirect.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/indexredirect.html">
            
                    
                    IndexRedirect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="programmiruem_perehodi.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/programmiruem_perehodi.html">
            
                    
                    Программируем переходы
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="razdelenie_dostupa.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/razdelenie_dostupa.html">
            
                    
                    Разделение доступа
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="podtverzhdenie_perehoda.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podtverzhdenie_perehoda.html">
            
                    
                    Подтверждение перехода
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="itogo_po_routingu.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/itogo_po_routingu.html">
            
                    
                    Итого по роутингу
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="podklyuchaem_redux.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podklyuchaem_redux.html">
            
                    
                    Подключаем redux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="storedispatch_redirekt.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html">
            
                    
                    store.dispatch редирект
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="zakritii_komponent.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/zakritii_komponent.html">
            
                    
                    "Закрытый" компонент
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="itogo_po_react-router_+_redux.html">
            
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/itogo_po_react-router_+_redux.html">
            
                    
                    Итого по react-router + redux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com/" target="blank" class="gitbook-link">
            Опубликовано с помощью GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <a class="btn pull-left js-toolbar-action" aria-label="" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html#"><i class="fa fa-align-justify"></i></a><div class="dropdown pull-right js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Share" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html#"><i class="fa fa-share-alt"></i></a><div class="dropdown-menu dropdown-left"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-5 ">Facebook</button><button class="button size-5 ">Google+</button><button class="button size-5 ">Twitter</button><button class="button size-5 ">Weibo</button><button class="button size-5 ">Instapaper</button></div></div></div><a class="btn pull-right js-toolbar-action" aria-label="" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html#"><i class="fa fa-facebook"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html#"><i class="fa fa-twitter"></i></a><div class="dropdown pull-left font-settings js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Font Settings" href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/storedispatch_redirekt.html#"><i class="fa fa-font"></i></a><div class="dropdown-menu dropdown-right"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-2 font-reduce">A</button><button class="button size-2 font-enlarge">A</button></div><div class="buttons"><button class="button size-2 ">Serif</button><button class="button size-2 ">Sans</button></div><div class="buttons"><button class="button size-3 ">White</button><button class="button size-3 ">Sepia</button><button class="button size-3 ">Night</button></div></div></div><h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/">store.dispatch редирект</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p class="comments-section"><em>ОБНОВЛЕНИЕ 2018: в учебнике хорошая теория, но ему уже два года. Проверяйте версии пакетов. За выходом нового учебника можно следить в <a href="http://bit.ly/2FI9nhs" target="_blank">telegram канале</a> или <a href="http://bit.ly/2FU6zRL" target="_blank">twitter</a></em><div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>На <a href="http://bit.ly/2FI9nhs" target="_blank">канале</a> так же проводятся бесплатные вебинары, публикуются переводы и авторские материалы, <a href="http://bit.ly/2FI9nhs" target="_blank">присоединяйтесь</a>!</em><div class="comments-icon"><div class="marker">+</div></div></p>
<hr>
<h1 id="storedispatch-редирект">store.dispatch редирект</h1>
<p class="comments-section">Данная глава неспроста называется store.dispatch редирект. Пожалуй, факт, что мы должны выполнить редирект с помощью <strong>store.dispatch</strong> - является основополагающим в этом подходе.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Чего мы добьемся в таком случае?<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Мы не нарушим однонаправленный (и самое важное, <em>четко контролируемый нами</em>) поток данных в приложении. По сути, весь роутинг - это действия (<em>actions</em>).<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Большинство библиотек (<a href="https://github.com/acdlite/redux-router" target="_blank">redux-router</a>, <a href="https://github.com/reactjs/react-router-redux" target="_blank">react-router-redux</a>) так и поступают. В них, каждое действие можно увидеть в логах.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Почему здесь, я не хочу разбирать эти отличные библиотеки? Потому что, я хочу показать вам как сделать редирект "вручную", чтобы вы четко понимали как это работает. Да, мы потеряем связь с <em><a href="https://github.com/gaearon/redux-devtools" target="_blank">redux-devtools</a></em> (в данном курсе не используется), да мы не будем "синхронизировать" данные роутера в <em>store</em>... Но так ли это важно и необходимо?<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Давайте просто будем использовать react-router напрямую. А в лог писать, только те действия с роутингом, которые нам действительно необходимы.<div class="comments-icon"><div class="marker">+</div></div></p>
<hr>
<p class="comments-section">Напоминаю, что предыдущий исходный код, дал следующий результат:
если мы пытаемся залогиниться - логируется LOGIN_REQUEST и ничего не происходит.<div class="comments-icon"><div class="marker">+</div></div></p>
<p><img src="./store.dispatch редирект · react-router-course-ru_files/login_request.jpg" alt="login_req_screen"></p>
<p class="comments-section">Для начала, оформим все необходимое для имитации логина. В "заглушке" будем, помимо свойства name, добавлять свойство <em>isAuthenticated</em><div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>src/actions/UserActions.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token operator">...</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> LOGIN_REQUEST
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> LOGIN_SUCCESS<span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre>
<p class="comments-section">В редьюсере, соответственно, будем корректно обрабатывать измененный <em>action</em>:<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>src/reducers</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token operator">...</span>
<span class="token keyword">case</span> LOGIN_SUCCESS<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> name<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>name<span class="token punctuation">,</span> isAuthenticated<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre>
<p class="comments-section"><em>На всякий случай: ... в начале и в конце = "другой код выше / ниже", а ... в строке return - <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/Spread_operator" target="_blank">spread operator</a></em> <div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Проверим:<div class="comments-icon"><div class="marker">+</div></div></p>
<p><img src="./store.dispatch редирект · react-router-course-ru_files/login_success.jpg" alt="login_success_screen"></p>
<p class="comments-section"><em>LocalStorage</em> в данный момент никак не используем.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Немного порассуждаем: если бы у нас была возможность "диспатчить" редирект, где бы мы это сделали? Очевидно, что после LOGIN_SUCCESS в таймауте.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Проблема в том, что мы не можем вызывать редирект, с помощью store.dispatch<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><strong>Вопрос</strong>: как это исправить?<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><strong>Ответ</strong>: написать middleware.<div class="comments-icon"><div class="marker">+</div></div></p>
<hr>
<p class="comments-section"><strong>Задача</strong>: требуется написать middleware, который в случае: action.type = РОУТИНГ, выполнял бы переход (с помощью browserHistory, разумеется).<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Дополнение <strong>#1</strong>: Было бы здорово, если бы мы имели возможность указывать push или replaceState метод.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><strong>Решение</strong> (<em>псевдо-код</em>):<div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code>import browserHistory
import КОНСТАНТА_РОУТИНГА

export const redirect = store =&gt; next =&gt; action =&gt; {
  if (action.type === КОНСТАНТА_РОУТИНГА) {
    browserHistory[МЕТОД](куда_перенаправить)
  }

  return next(action)
}
</code></pre><p class="comments-section">Предлагаю решить самостоятельно, а после сверится с кодом ниже.<div class="comments-icon"><div class="marker">+</div></div></p>
<hr>
<h4 id="решение-создание-middleware-для-роутинга">Решение: создание middleware для роутинга</h4>
<p class="comments-section"><em>src/constants/Routing.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token keyword">export</span> <span class="token keyword">const</span> ROUTING <span class="token operator">=</span> <span class="token string">'ROUTING'</span>
</code></pre>
<p class="comments-section"><em>src/middlewares/redirect.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> browserHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ROUTING
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../constants/Routing'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> redirect <span class="token operator">=</span> store <span class="token operator">=</span><span class="token operator">&gt;</span> next <span class="token operator">=</span><span class="token operator">&gt;</span> action <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//eslint-disable-line no-unused-vars</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> ROUTING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    browserHistory<span class="token punctuation">[</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>nextUrl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="comments-section">События связанные с роутингом мы не будем обрабатывать редьюсером.<div class="comments-icon"><div class="marker">+</div></div></p>
<hr>
<p class="comments-section">Обновим <em>actionCreator</em> (функцию-создатель действия):<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>src/actions/UserActions.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ROUTING
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../constants/Routing'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> LOGIN_REQUEST
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> LOGIN_SUCCESS<span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> ROUTING<span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          method<span class="token punctuation">:</span> <span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//или, например, replace</span>
          nextUrl<span class="token punctuation">:</span> <span class="token string">'/admin'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre>
<p class="comments-section"><strong>Вопрос</strong>: где мы должны добавить middleware в цепочку других middleware'ов ?<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><strong>Ответ</strong>: там, где настраивается объект <em>store</em><div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>src/store/configureStore.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../middlewares/redirect'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunkMiddleware<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>redirect<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// добавили редирект middleware</span>
  <span class="token punctuation">)</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre>
<p class="comments-section">Очистим метод <em>onEnter</em> у компонента <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Admin</span> <span class="token punctuation">/&gt;</span></span></code>:<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><em>src/components/Admin/index.js</em><div class="comments-icon"><div class="marker">+</div></div></p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Admin</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">onEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// nothing</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'row'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'col-md-12'</span><span class="token operator">&gt;</span>Раздел <span class="token operator">/</span>admin<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<p class="comments-section">Откройте в браузере <code>http://localhost:3000/login</code> и попробуйте залогиниться (введите любое имя):<div class="comments-icon"><div class="marker">+</div></div></p>
<p><img src="./store.dispatch редирект · react-router-course-ru_files/login_with_redirect.jpg" alt="login_with_redirect_screen"></p>
<p class="comments-section">Теперь нажмите "назад" - вы должны оказаться на странице <code>/login</code>, так как мы использовали метод <strong>push</strong>. Данный метод добавляет страницу в историю браузера. <strong>replace</strong> же, не добавляет страницу в историю браузера, но тем не менее url меняет. Скоро мы поработаем с ним.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section">Не забывайте про возможность пользователя нажимать "назад/вперед".<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><strong>Итог</strong>: мы научились делать редирект посредством <strong>store.dispatch</strong>, но сломали <em>onEnter hook</em>, теперь страница <code>/admin</code> доступна всегда. Исправим это в следующем уроке.<div class="comments-icon"><div class="marker">+</div></div></p>
<p class="comments-section"><a href="https://github.com/maxfarseer/react-router-ru-tutorial/tree/middleware_redirect_v2" target="_blank">Исходный код</a> на данный момент.<div class="comments-icon"><div class="marker">+</div></div></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/podklyuchaem_redux.html" class="navigation navigation-prev " aria-label="Previous page: Подключаем redux">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="https://maxfarseer.gitbooks.io/react-router-course-ru/content/zakritii_komponent.html" class="navigation navigation-next " aria-label="Next page: " Закрытый"="" компонент"="" style="margin-right: 0px;">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"store.dispatch редирект","level":"1.5.1","depth":2,"next":{"title":"\"Закрытый\" компонент","level":"1.5.2","depth":2,"path":"zakritii_komponent.md","ref":"zakritii_komponent.md","articles":[]},"previous":{"title":"Подключаем redux","level":"1.5","depth":1,"path":"podklyuchaem_redux.md","ref":"podklyuchaem_redux.md","articles":[{"title":"store.dispatch редирект","level":"1.5.1","depth":2,"path":"storedispatch_redirekt.md","ref":"storedispatch_redirekt.md","articles":[]},{"title":"\"Закрытый\" компонент","level":"1.5.2","depth":2,"path":"zakritii_komponent.md","ref":"zakritii_komponent.md","articles":[]},{"title":"Итого по react-router + redux","level":"1.5.3","depth":2,"path":"itogo_po_react-router_+_redux.md","ref":"itogo_po_react-router_+_redux.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","comment"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"comment":{"highlightCommented":true},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Max P","pdf":{"pageNumbers":true,"fontSize":16,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"react-router-course-ru","language":"ru","links":{"sidebar":{"react-router-course-ru":"https://www.gitbook.com/book/maxfarseer/react-router-course-ru"},"gitbook":true},"gitbook":"*","description":"Роутинг в react приложениях. Рассматривается react-router, react-router + redux"},"file":{"path":"storedispatch_redirekt.md","mtime":"2018-03-15T05:50:34.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-03-15T06:04:13.220Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="./store.dispatch редирект · react-router-course-ru_files/gitbook.js"></script>
    <script src="./store.dispatch редирект · react-router-course-ru_files/theme.js"></script>
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/plugin.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/search-engine.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/search.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/lunr.min.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/search-lunr.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/buttons.js"></script>
        
    
        
        <script src="./store.dispatch редирект · react-router-course-ru_files/fontsettings.js"></script>
        
    

    
<div><script style="display: none;" type="application/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57505611-7', 'auto', {name: 'microcdn'});
  ga('microcdn.send', 'pageview');

  var _cdn_prev_loc = window.location.pathname;
  window.setInterval(function () {
    if (window.location.pathname !== _cdn_prev_loc) {
      _cdn_prev_loc = window.location.pathname;
      ga('microcdn.send', 'pageview');
    }
  }, 100);

</script></div>



</body></html>